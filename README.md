# SharpEmailC2

SharpEmailC2是一个基于IMAP协议的C2工具。工具通过草稿箱进行读写对CS数据进行中继。该工具可在紫队行动中对邮件安全网关、邮件沙箱设备进行有效性检测。

# 使用场景

- 无法出网：在某些企业演练中的合法钓鱼测试中员工机器无法直接出网
- 关键区域：企业内部攻防中抵达某些区域无法直接出网
- 紫队行动中对邮件安全设备进行检测

# 使用方法

```
1.修改SharpEmailC2项目中的Constants.cs文件，填入目标邮件地址、帐号、密码；
2.修改Controller.py中的Drafts类，填入目标邮件地址、帐号、密码；
3.cs加载额外C2插件：externalc2_start("0.0.0.0", 2222);
3.修改Controller.py中的transfer = transferProtocol("xxx.xxx.xxx.xxx", 2222)，IP地址和端口为上述IP与端口
4.启动cs，运行Controller.py
5.运行SharpEmailC2.exe
```

# 演示视频

<video src="video.mov" />

# 注意事项

```
1.命令执行不成功可以多试几次，当Controller与Client同事操纵同一封邮件时会导致其中一方无法读取到邮件内容导致命令执行失败
2.Client的管道交互重试多半是由于以上原因，可以无限增加重试次数解决
3.上传与下载的大小大多在3M以下，如有大文件传输需求可更改DraftsIO.Write方法：增加锁机制，如果对方未读则延迟再发，确保对方不漏包；新增附件传输方法；
```

# 免责声明
本工具仅面向合法授权的企业安全建设行为或教学使用，如您需要测试本工具的可用性，请自行搭建靶机环境。

在使用本工具进行检测时，您应确保该行为符合当地的法律法规，并且已经取得了足够的授权。请勿对非授权目标进行扫描和攻击。

如您在使用本工具的过程中存在任何非法行为，您需自行承担相应后果，作者将不承担任何法律及连带责任。

在安装并使用本工具前，请您务必审慎阅读、充分理解各条款内容，限制、免责条款或者其他涉及您重大权益的条款可能会以加粗、加下划线等形式提示您重点注意。 除非您已充分阅读、完全理解并接受本协议所有条款，否则，请您不要安装并使用本工具。您的使用行为或者您以其他任何明示或者默示方式表示接受本协议的，即视为您已阅读并同意本协议的约束。

# 安恒-星火实验室
<h1 align="center">
  <img src="starfire.jpeg" alt="starfire" width="200px">
  <br>
</h1>


专注于实战攻防与研究，研究涉及实战攻防、威胁情报、攻击模拟与威胁分析等，团队成员均来自行业具备多年实战攻防经验的红队、蓝队和紫队专家。本着以攻促防的核心理念，通过落地 ATT&CK 攻防全景知识库，全面构建实战化、常态化、体系化的企业安全建设与运营。